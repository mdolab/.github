on:
  workflow_call:

jobs:
  format-and-lint:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v5
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.12
      - name: Install dependencies
        run: |
          wget https://raw.githubusercontent.com/mdolab/.github/main/.pre-commit-config.yaml
          pip install pre-commit
          # If there's already a ruff.toml file in the repo, we should rename the file we're downloading to ruff.toml-global, then put the line `extend = "ruff.toml-global"` at the top of the local ruff.toml so that ruff will use both configurations.
          url=https://raw.githubusercontent.com/mdolab/.github/main/ruff.toml
          if [[ -f "ruff.toml" ]]; then
            wget $url -O ruff.toml-global;
            sed -i '1s/^/extend = "ruff.toml-global" \n/' ruff.toml
          else
            wget $url
          fi
          echo "Ruff config:"
          if [[ -f "ruff.toml-global" ]]; then
              cat ruff.toml-global
          fi
          cat ruff.toml
      - name: Run pre-commit checks
        run: |
          pre-commit run --all-files --show-diff-on-failure
