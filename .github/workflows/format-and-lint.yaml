on:
  workflow_call:

jobs:
  format-and-lint:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v5
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.12
      # Change ruffConfig to main before merge
      - name: Install dependencies
        run: |
          wget https://raw.githubusercontent.com/mdolab/.github/ruffConfig/.pre-commit-config.yaml
          pip install pre-commit
          # If there's already a ruff.toml file in the repo, we should rename it to ruff.toml-project, then download the mdolab ruff.toml file edit it to put the line `extend = "ruff.toml-project"` at the top so that ruff will use both configurations.
          if [[ -f "ruff.toml" ]]; then
            mv ruff.toml ruff.toml-project;
          fi
          wget https://raw.githubusercontent.com/mdolab/.github/ruffConfig/ruff.toml
          if [[ -f "ruff.toml-project" ]]; then
              sed -i '1s/^/extend = "ruff.toml-project" \n/' ruff.toml
          fi
      - name: Run pre-commit checks
        run: |
          pre-commit run --all-files --show-diff-on-failure
